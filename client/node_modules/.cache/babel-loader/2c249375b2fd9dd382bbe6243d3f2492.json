{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _createForOfIteratorHelper from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import axios from'axios';import React,{useState}from'react';import{Form,Button}from'react-bootstrap';import{useHistory}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Uploader=function Uploader(_ref){var data=_ref.data;var history=useHistory();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),selectedFiles=_useState2[0],setSelectedFiles=_useState2[1];var toProductPage=function toProductPage(id){history.push(\"/\".concat(id));document.getElementById('add-product-link').style.display='block';};var handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var isFilled,videoRequests,imageRequests,_iterator,_step,file,formData,_file$type$split,_file$type$split2,type,url,videoResponses,imageResponses,response,id;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:isFilled=Object.keys(data).every(function(key){return data[key];});_context.prev=1;if(!(!selectedFiles||!isFilled)){_context.next=4;break;}return _context.abrupt(\"return\");case 4:videoRequests=[];imageRequests=[];_iterator=_createForOfIteratorHelper(selectedFiles);try{for(_iterator.s();!(_step=_iterator.n()).done;){file=_step.value;formData=new FormData();formData.append('file',file);formData.append('folder',process.env.REACT_APP_UPLOAD_FOLDER);formData.append('upload_preset',process.env.REACT_APP_UPLOAD_PRESET);_file$type$split=file.type.split('/'),_file$type$split2=_slicedToArray(_file$type$split,1),type=_file$type$split2[0];url=\"https://api.cloudinary.com/v1_1/\".concat(process.env.REACT_APP_CLOUD_NAME);if(type==='video')videoRequests.push(axios.post(\"\".concat(url,\"/video/upload\"),formData));if(type==='image')imageRequests.push(axios.post(\"\".concat(url,\"/image/upload\"),formData));}}catch(err){_iterator.e(err);}finally{_iterator.f();}_context.next=10;return axios.all(videoRequests);case 10:videoResponses=_context.sent;_context.next=13;return axios.all(imageRequests);case 13:imageResponses=_context.sent;data.videos=videoResponses.map(function(response){return response.data.secure_url;});data.images=imageResponses.map(function(response){return response.data.secure_url;});_context.next=18;return axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/products/create\"),data);case 18:response=_context.sent;id=response.data.id;if(id)toProductPage(id);_context.next=26;break;case 23:_context.prev=23;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 26:case\"end\":return _context.stop();}}},_callee,null,[[1,23]]);}));return function handleClick(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Form.File,{required:true,multiple:true,type:\"file\",accept:\"image/*, video/*\",onChange:function onChange(e){return setSelectedFiles(e.target.files);}}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{type:\"submit\",className:\"w-100\",onClick:handleClick,style:{background:'var(--color-main)'},children:\"Add Product\"})]});};export default Uploader;","map":{"version":3,"sources":["C:/Users/Dee/Desktop/test-deploy/client/src/components/Uploader.js"],"names":["axios","React","useState","Form","Button","useHistory","Uploader","data","history","selectedFiles","setSelectedFiles","toProductPage","id","push","document","getElementById","style","display","handleClick","isFilled","Object","keys","every","key","videoRequests","imageRequests","file","formData","FormData","append","process","env","REACT_APP_UPLOAD_FOLDER","REACT_APP_UPLOAD_PRESET","type","split","url","REACT_APP_CLOUD_NAME","post","all","videoResponses","imageResponses","videos","map","response","secure_url","images","REACT_APP_API_URL","console","error","e","target","files","background"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport React, { useState } from 'react';\r\nimport { Form, Button } from 'react-bootstrap';\r\nimport { useHistory } from 'react-router-dom';\r\n\r\nconst Uploader = ({ data }) => {\r\n  const history = useHistory();\r\n\r\n  const [selectedFiles, setSelectedFiles] = useState(null);\r\n\r\n  const toProductPage = (id) => {\r\n    history.push(`/${id}`);\r\n    document.getElementById('add-product-link').style.display = 'block';\r\n  };\r\n\r\n  const handleClick = async () => {\r\n    const isFilled = Object.keys(data).every((key) => data[key]);\r\n    try {\r\n      if (!selectedFiles || !isFilled) return;\r\n\r\n      const videoRequests = [];\r\n      const imageRequests = [];\r\n\r\n      for (const file of selectedFiles) {\r\n        const formData = new FormData();\r\n\r\n        formData.append('file', file);\r\n        formData.append('folder', process.env.REACT_APP_UPLOAD_FOLDER);\r\n        formData.append('upload_preset', process.env.REACT_APP_UPLOAD_PRESET);\r\n\r\n        const [type] = file.type.split('/');\r\n        const url = `https://api.cloudinary.com/v1_1/${process.env.REACT_APP_CLOUD_NAME}`;\r\n\r\n        if (type === 'video') videoRequests.push(axios.post(`${url}/video/upload`, formData));\r\n        if (type === 'image') imageRequests.push(axios.post(`${url}/image/upload`, formData));\r\n      }\r\n\r\n      const videoResponses = await axios.all(videoRequests);\r\n      const imageResponses = await axios.all(imageRequests);\r\n\r\n      data.videos = videoResponses.map((response) => response.data.secure_url);\r\n      data.images = imageResponses.map((response) => response.data.secure_url);\r\n\r\n      const response = await axios.post(`${process.env.REACT_APP_API_URL}/products/create`, data);\r\n      const { id } = response.data;\r\n\r\n      if (id) toProductPage(id);\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Form.File\r\n        required\r\n        multiple\r\n        type=\"file\"\r\n        accept=\"image/*, video/*\"\r\n        onChange={(e) => setSelectedFiles(e.target.files)}\r\n      />\r\n      <br />\r\n\r\n      <Button\r\n        type=\"submit\"\r\n        className=\"w-100\"\r\n        onClick={handleClick}\r\n        style={{ background: 'var(--color-main)' }}\r\n      >\r\n        Add Product\r\n      </Button>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Uploader;\r\n"]},"metadata":{},"sourceType":"module"}