{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import axios from'axios';import{loadStripe}from'@stripe/stripe-js';import React,{useState,useContext}from'react';import{AuthContext}from'../context/AuthContext';import{Form,Alert,Button}from'react-bootstrap';import{Elements,CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PaymentForm=function PaymentForm(_ref){var product=_ref.product,shippingAddress=_ref.shippingAddress;var stripe=useStripe();var elements=useElements();var _useContext=useContext(AuthContext),user=_useContext.user;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),success=_useState2[0],setSuccess=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var CARD_OPTIONS={iconStyle:'solid',style:{base:{color:'#32325d',fontSize:'1.2rem',iconColor:'#32325d',fontFamily:'Arial',fontSmoothing:'antialiased','::placeholder':{color:'#cccccc'},':-webkit-autofill':{color:'#fce883'}},invalid:{color:'#fa755a',iconColor:'#fa755a'}}};var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _yield$stripe$createP,error,paymentMethod,id,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();setLoading(true);_context.next=4;return stripe.createPaymentMethod({type:'card',card:elements.getElement(CardElement)});case 4:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){_context.next=21;break;}_context.prev=8;id=paymentMethod.id;_context.next=12;return axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/orders/checkout\"),{id:id,user:user._id,product:product._id,amount:product.price,address:shippingAddress._id});case 12:response=_context.sent;if(response.data.success){setSuccess(true);document.getElementById('addresses_dropdown').disabled=true;}_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](8);console.error(\"Error \".concat(_context.t0));case 19:_context.next=22;break;case 21:console.error(error.message);case 22:setLoading(false);case 23:case\"end\":return _context.stop();}}},_callee,null,[[8,16]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(_Fragment,{children:!success?/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{options:CARD_OPTIONS}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:loading||!shippingAddress,style:{width:'100%',marginTop:'10px',background:'var(--color-main)'},children:\"Pay now\"})]}):/*#__PURE__*/_jsx(Alert,{variant:\"success\",children:\"Thank you!\"})});};var Payment=function Payment(_ref3){var product=_ref3.product,shippingAddress=_ref3.shippingAddress;var stripePromise=loadStripe(process.env.REACT_APP_PUBLIC_KEY);return/*#__PURE__*/_jsx(Elements,{stripe:stripePromise,children:/*#__PURE__*/_jsx(PaymentForm,{product:product,shippingAddress:shippingAddress})});};export default Payment;","map":{"version":3,"sources":["C:/Users/Dee/Desktop/test-deploy/client/src/components/Payment.js"],"names":["axios","loadStripe","React","useState","useContext","AuthContext","Form","Alert","Button","Elements","CardElement","useElements","useStripe","PaymentForm","product","shippingAddress","stripe","elements","user","success","setSuccess","loading","setLoading","CARD_OPTIONS","iconStyle","style","base","color","fontSize","iconColor","fontFamily","fontSmoothing","invalid","handleSubmit","e","preventDefault","createPaymentMethod","type","card","getElement","error","paymentMethod","id","post","process","env","REACT_APP_API_URL","_id","amount","price","address","response","data","document","getElementById","disabled","console","message","width","marginTop","background","Payment","stripePromise","REACT_APP_PUBLIC_KEY"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport React, { useState, useContext } from 'react';\r\nimport { AuthContext } from '../context/AuthContext';\r\nimport { Form, Alert, Button } from 'react-bootstrap';\r\nimport { Elements, CardElement, useElements, useStripe } from '@stripe/react-stripe-js';\r\n\r\nconst PaymentForm = ({ product, shippingAddress }) => {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n\r\n  const { user } = useContext(AuthContext);\r\n\r\n  const [success, setSuccess] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const CARD_OPTIONS = {\r\n    iconStyle: 'solid',\r\n    style: {\r\n      base: {\r\n        color: '#32325d',\r\n        fontSize: '1.2rem',\r\n        iconColor: '#32325d',\r\n        fontFamily: 'Arial',\r\n        fontSmoothing: 'antialiased',\r\n        '::placeholder': { color: '#cccccc' },\r\n        ':-webkit-autofill': { color: '#fce883' },\r\n      },\r\n      invalid: {\r\n        color: '#fa755a',\r\n        iconColor: '#fa755a',\r\n      },\r\n    },\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    const { error, paymentMethod } = await stripe.createPaymentMethod({\r\n      type: 'card',\r\n      card: elements.getElement(CardElement),\r\n    });\r\n\r\n    if (!error) {\r\n      try {\r\n        const { id } = paymentMethod;\r\n        const response = await axios.post(`${process.env.REACT_APP_API_URL}/orders/checkout`, {\r\n          id,\r\n          user: user._id,\r\n          product: product._id,\r\n          amount: product.price,\r\n          address: shippingAddress._id,\r\n        });\r\n\r\n        if (response.data.success) {\r\n          setSuccess(true);\r\n          document.getElementById('addresses_dropdown').disabled = true;\r\n        }\r\n      } catch (error) {\r\n        console.error(`Error ${error}`);\r\n      }\r\n    } else {\r\n      console.error(error.message);\r\n    }\r\n\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {!success ? (\r\n        <Form onSubmit={handleSubmit}>\r\n          <CardElement options={CARD_OPTIONS} />\r\n          <Button\r\n            type=\"submit\"\r\n            disabled={loading || !shippingAddress}\r\n            style={{\r\n              width: '100%',\r\n              marginTop: '10px',\r\n              background: 'var(--color-main)',\r\n            }}\r\n          >\r\n            Pay now\r\n          </Button>\r\n        </Form>\r\n      ) : (\r\n        <Alert variant=\"success\">Thank you!</Alert>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nconst Payment = ({ product, shippingAddress }) => {\r\n  const stripePromise = loadStripe(process.env.REACT_APP_PUBLIC_KEY);\r\n\r\n  return (\r\n    <Elements stripe={stripePromise}>\r\n      <PaymentForm product={product} shippingAddress={shippingAddress} />\r\n    </Elements>\r\n  );\r\n};\r\n\r\nexport default Payment;\r\n"]},"metadata":{},"sourceType":"module"}