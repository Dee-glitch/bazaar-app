{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Dee/Desktop/test-deploy/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext,useEffect,useReducer,useState,useContext}from'react';import AuthReducer from'./AuthReducer';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";var INITIAL_STATE={user:JSON.parse(localStorage.getItem(\"user\"))||null,isFetching:false,error:false};var AuthContext=/*#__PURE__*/createContext(INITIAL_STATE);var AuthContextProvider=function AuthContextProvider(_ref){var children=_ref.children;var _useReducer=useReducer(AuthReducer,INITIAL_STATE),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var _useContext=useContext(AuthContext),user=_useContext.user;var _useState=useState(user?user.favorites:[]),_useState2=_slicedToArray(_useState,2),addedFave=_useState2[0],setAddedFave=_useState2[1];var _useState3=useState(user),_useState4=_slicedToArray(_useState3,2),currentUser=_useState4[0],setCurrentUser=_useState4[1];useEffect(function(){localStorage.setItem(\"user\",JSON.stringify(state.user));},[state.user]);useEffect(function(){localStorage.setItem(\"user\",JSON.stringify(currentUser));},[currentUser]);var newF;// adds favorite to the local storage and user object\nvar addFavorite=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user,_id){var newFavorites,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;newF=addedFave.filter(function(item){return item!==_id;});newFavorites=[].concat(_toConsumableArray(newF),[_id]);_context.next=5;return axios.patch(\"\".concat(process.env.REACT_APP_API_URL,\"/users/update/\").concat(user._id),{favorites:newFavorites});case 5:response=_context.sent;setAddedFave(newFavorites);if(user){setCurrentUser(response.data);}_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function addFavorite(_x,_x2){return _ref2.apply(this,arguments);};}();// deletes favorite from the local storage and user object\nvar deleteFavorite=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(user,_id){var newList,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:newList=currentUser.favorites.filter(function(item){return item!==_id;});_context2.prev=1;_context2.next=4;return axios.patch(\"\".concat(process.env.REACT_APP_API_URL,\"/users/update/\").concat(user._id),{favorites:newList});case 4:response=_context2.sent;setCurrentUser(response.data);_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return function deleteFavorite(_x3,_x4){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user:state.user,isFetching:state.isFetching,error:state.error,dispatch:dispatch,addFavorite:addFavorite,deleteFavorite:deleteFavorite,currentUser:currentUser,setCurrentUser:setCurrentUser},children:!state.isFetching&&children});};export{AuthContext,AuthContextProvider};","map":{"version":3,"sources":["C:/Users/Dee/Desktop/test-deploy/client/src/context/AuthContext.js"],"names":["React","createContext","useEffect","useReducer","useState","useContext","AuthReducer","axios","INITIAL_STATE","user","JSON","parse","localStorage","getItem","isFetching","error","AuthContext","AuthContextProvider","children","state","dispatch","favorites","addedFave","setAddedFave","currentUser","setCurrentUser","setItem","stringify","newF","addFavorite","_id","filter","item","newFavorites","patch","process","env","REACT_APP_API_URL","response","data","console","log","deleteFavorite","newList"],"mappings":"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","sourcesContent":["import React, { createContext, useEffect, useReducer, useState, useContext } from 'react';\r\nimport AuthReducer from './AuthReducer';\r\nimport axios from 'axios';\r\nconst INITIAL_STATE = {\r\n  user: JSON.parse(localStorage.getItem(`user`)) || null,\r\n  isFetching: false,\r\n  error: false,\r\n};\r\n\r\nconst AuthContext = createContext(INITIAL_STATE);\r\n\r\nconst AuthContextProvider = ({ children }) => {\r\n  const [state, dispatch] = useReducer(AuthReducer, INITIAL_STATE);\r\n\r\n  const { user } = useContext(AuthContext);\r\n  const [addedFave, setAddedFave] = useState(user ? user.favorites : []);\r\n  const [currentUser, setCurrentUser] = useState(user);\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem(`user`, JSON.stringify(state.user));\r\n  }, [state.user]);\r\n  useEffect(() => {\r\n    localStorage.setItem(`user`, JSON.stringify(currentUser));\r\n  }, [currentUser]);\r\n\r\n  let newF;\r\n  // adds favorite to the local storage and user object\r\n  const addFavorite = async (user, _id) => {\r\n    try {\r\n      newF = addedFave.filter((item) => item !== _id);\r\n      const newFavorites = [...newF, _id];\r\n      const response = await axios.patch(\r\n        `${process.env.REACT_APP_API_URL}/users/update/${user._id}`,\r\n        {\r\n          favorites: newFavorites,\r\n        },\r\n      );\r\n      setAddedFave(newFavorites);\r\n      if (user) {\r\n        setCurrentUser(response.data);\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  // deletes favorite from the local storage and user object\r\n  const deleteFavorite = async (user, _id) => {\r\n    const newList = currentUser.favorites.filter((item) => item !== _id);\r\n\r\n    try {\r\n      const response = await axios.patch(\r\n        `${process.env.REACT_APP_API_URL}/users/update/${user._id}`,\r\n        {\r\n          favorites: newList,\r\n        },\r\n      );\r\n\r\n      setCurrentUser(response.data);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user: state.user,\r\n        isFetching: state.isFetching,\r\n        error: state.error,\r\n        dispatch,\r\n        addFavorite,\r\n        deleteFavorite,\r\n        currentUser,\r\n        setCurrentUser,\r\n      }}\r\n    >\r\n      {!state.isFetching && children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport { AuthContext, AuthContextProvider };\r\n"]},"metadata":{},"sourceType":"module"}